{"entries":[{"timestamp":1765712150662,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":185,"diffs":[[1,"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":161,"diffs":[[1,""]]},{"start1":1,"length1":5540,"diffs":[[1,""]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":114,"length1":111,"diffs":[[1,"        \"microphone\": \"*\"\n"]]},{"start1":231,"length1":31,"diffs":[[1,"    \"additionalFilePaths\": []\n"]]}]}]},{"timestamp":1765712726911,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":4669,"length1":61,"diffs":[[1,"            if (messageHandler)\n                messageHandler()\n"]]},{"start1":4851,"length1":459,"diffs":[[1,""]]}]}]},{"timestamp":1765712965045,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":4904,"length1":41,"diffs":[[1,"    //% block.loc.nl=\"verwerk een commando\"\n"]]}]}]},{"timestamp":1765715129603,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":4904,"length1":43,"diffs":[[1,"    //% block.loc.nl=\"verwerk  commando\"\n"]]}]}]},{"timestamp":1765715131084,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":84,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"20\" y=\"20\"></block><block type=\"device_forever\" x=\"225\" y=\"20\"></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":4904,"length1":130,"diffs":[[1,"    //% block.loc.nl=\"verwerk de commando\"\n    export function onCommand(button: Key, code: () => void): void {\n        switch (button) {\n            case Key.Up: releasedUpHandler = code; break;\n            case Key.Down: releasedDownHandler = code; break;\n            case Key.Left: releasedLeftHandler = code; break;\n            case Key.Right: releasedRightHandler = code; break;\n        }\n"]]},{"start1":5305,"length1":128,"diffs":[[1,""]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":316,"length1":44,"diffs":[[1,""]]}]},{"type":"added","filename":"test.ts","value":"// tests gaan hier; deze zal niet worden gecompileerd wanneer dit pakket wordt gebruikt als extensie.\n"}]}],"snapshots":[{"timestamp":1765712150661,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>","main.ts":"\n","README.md":"","pxt.json":"{\n    \"name\": \"rpimedia\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"additionalFilePaths\": []\n}\n"}},{"timestamp":1765715129603,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"20\" y=\"20\"></block><block type=\"device_forever\" x=\"225\" y=\"20\"></block></xml>","main.ts":"//////////////////////\n//##################//\n//##              ##//\n//##  eserial.ts  ##//\n//##              ##//\n//##################//\n//////////////////////\n\nnamespace ESerial {\n\n    let g_init = false\n    let g_read: string[]\n    let g_write: string[]\n    g_read = []\n    g_write = []\n    let g_read_tmo = 0\n    let g_write_tmo = 0\n\n    let g_tx_dat: DigitalPin\t// tx out data\n    let g_tx_rdy: DigitalPin\t// tx out data valid\n    let g_tx_rcv: DigitalPin\t// tx in  data received\n    let g_rx_dat: DigitalPin\t// rx in  data\n    let g_rx_rdy: DigitalPin\t// rx in  data valid\n    let g_rx_rcv: DigitalPin\t// rx out data received\n\n    function initESerial() {\n        pins.digitalWritePin(g_tx_dat, 0)\n        pins.digitalWritePin(g_tx_rdy, 0)\n        pins.digitalReadPin(g_tx_rcv)\n        pins.digitalReadPin(g_rx_dat)\n        pins.digitalReadPin(g_rx_rdy)\n        pins.digitalWritePin(g_rx_rcv, 0)\n        g_read = []\n        g_write = []\n    }\n\n    function writeChar(char: string) {\n        let ch = char.charCodeAt(0)\n        let pin: number\n        for (let i = 0; i < 8; i++) {\n            pin = (ch & (1 << i))\n            pins.digitalWritePin(g_tx_dat, pin == 0 ? 0 : 1)\n            pins.digitalWritePin(g_tx_rdy, 1)\n            while (!pins.digitalReadPin(g_tx_rcv)) {\n                if (control.millis() > g_write_tmo) { initESerial(); return; }\n            }\n            pins.digitalWritePin(g_tx_rdy, 0)\n            while (pins.digitalReadPin(g_tx_rcv)) {\n                if (control.millis() > g_write_tmo) { initESerial(); return; }\n            }\n        }\n    }\n\n    function readChar(): string {\n        let pin: number\n        let ch = 0\n        for (let i = 0; i < 8; i++) {\n            while (!pins.digitalReadPin(g_rx_rdy)) {\n                if (control.millis() > g_read_tmo) { initESerial(); return \"\"; }\n            }\n            pin = pins.digitalReadPin(g_rx_dat)\n            ch |= (pin << i)\n            pins.digitalWritePin(g_rx_rcv, 1)\n            while (pins.digitalReadPin(g_rx_rdy)) {\n                if (control.millis() > g_read_tmo) { initESerial(); return \"\"; }\n            }\n            pins.digitalWritePin(g_rx_rcv, 0)\n        }\n        let ret = (ch == 0 ? \"\" : String.fromCharCode(ch))\n        return ret\n    }\n\n    // write strings\n    basic.forever(function () {\n        if (!g_init) return;\n        if (g_write.length > 0) {\n            g_write_tmo = control.millis() + 5000\n            let str = g_write.shift()\n            for (let i = 0; i < str.length; i++) {\n                if (control.millis() > g_write_tmo) { initESerial(); break; }\n                writeChar(str[i])\n            }\n            writeChar(String.fromCharCode(0))\n        }\n    })\n\n    // read strings\n    basic.forever(function () {\n        if (!g_init) return;\n        let str = \"\"\n        let ch = \"\"\n        if ((pins.digitalReadPin(g_rx_rdy) == 1)) { // available\n            g_read_tmo = control.millis() + 5000\n            do {\n                ch = readChar()\n                str += ch\n            } while (!ch.isEmpty())\n            if (control.millis() <= g_read_tmo)\n                g_read.push(str)\n            str = \"\"\n        }\n    })\n\n    export function setPins(tx_dat: DigitalPin,\n        tx_rdy: DigitalPin,\n        tx_rcv: DigitalPin,\n        rx_dat: DigitalPin,\n        rx_rdy: DigitalPin,\n        rx_rcv: DigitalPin) {\n        g_tx_dat = tx_dat\n        g_tx_rdy = tx_rdy\n        g_tx_rcv = tx_rcv\n        g_rx_dat = rx_dat\n        g_rx_rdy = rx_rdy\n        g_rx_rcv = rx_rcv\n\n        initESerial()\n        g_init = true\n    }\n\n    export function available(): boolean {\n        return (g_read.length > 0)\n    }\n\n    export function write(str: string) {\n        g_write.push(str)\n    }\n\n    export function read(): string {\n        if (g_read.length)\n            return g_read.shift()\n        return \"\"\n    }\n}\n\n///////////////////////\n//###################//\n//##               ##//\n//##  rpimedia.ts  ##//\n//##               ##//\n//###################//\n///////////////////////\n\nlet mediaHandler: handler\n\nbasic.showIcon(IconNames.Heart)\nESerial.setPins(\n    DigitalPin.P0,     // tx-dat >> rx-dat RPI GPIO 10\n    DigitalPin.P1,     // tx-rdy >> rx-rdy RPI GPIO 9\n    DigitalPin.P2,     // tx-rcv >> rx-rcv RPI GPIO 11\n    DigitalPin.P14,    // rx-dat >> tx-dat RPI GPIO 5\n    DigitalPin.P15,    // rx-rdy >> tx-rdy RPI GPIO 6\n    DigitalPin.P16     // rx-rcv >> tx-rcv RPI GPIO 13\n)\nbasic.showIcon(IconNames.Yes)\n\nlet READY = false\nlet RPIMSG = \"\"\n\nbasic.forever(function () {\n    if (ESerial.available()) {\n        READY = true\n        RPIMSG = ESerial.read()\n        if (RPIMSG == \"RDY\")\n            READY = true\n        else\n            if (mediaHandler)\n                mediaHandler()\n    }\n})\n\n//% color=\"#00CC00\" icon=\"\\uf1f9\"\n//% block=\"RPi Media\"\n//% block.loc.nl=\"RPi Media\"\nnamespace RPiMedia {\n\n    //% color=\"#FFC000\"\n    //% block=\"execute commands\"\n    //% block.loc.nl=\"verwerk een commando\"\n    export function onCommand(button: Key, code: () => void): void {\n        switch (button) {\n            case Key.Up: releasedUpHandler = code; break;\n            case Key.Down: releasedDownHandler = code; break;\n            case Key.Left: releasedLeftHandler = code; break;\n            case Key.Right: releasedRightHandler = code; break;\n        }\n    }\n\n    //% block=\"wait until video finished\"\n    //% block.loc.nl=\"wacht tot de clip klaar is\"\n    export function waitFinished() {\n        while (!READY) basic.pause(1)\n    }\n\n    //% block=\"stop\"\n    //% block.loc.nl=\"stop\"\n    export function stop() {\n        ESerial.write(\"stop\")\n        READY = true\n    }\n\n    //% block=\"show the standby screen\"\n    //% block.loc.nl=\"toon het standby-scherm\"\n    export function showStandby() {\n        ESerial.write(\"standby\")\n        READY = true\n    }\n\n    //% block=\"show image %name\"\n    //% block.loc.nl=\"toon afbeelding %name\"\n    export function showImage(name: string) {\n        ESerial.write(name)\n        READY = true\n    }\n\n    //% block=\"show video %name\"\n    //% block.loc.nl=\"toon video %name\"\n    export function showVideo(name: string) {\n        ESerial.write(name)\n        READY = false\n    }\n}\n","README.md":"","pxt.json":"{\n    \"name\": \"rpimedia\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\",\n        \"general\": \"github:ETmbit/general#4ea1e3f3224a0692900d0a9e2898a515af73c9a0\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"preferredEditor\": \"tsprj\"\n}\n"}}],"shares":[],"lastSaveTime":1765715583149}